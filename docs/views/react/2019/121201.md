---
title: react å®Œæ•´é¡¹ç›®æ­å»ºæ¡ˆä¾‹
date: 2019-12-12
tags:
 - react      
categories: 
 - react
---

::: tip
æœ¬é¡¹ç›®ä½¿ç”¨ `create-react-app` åˆå§‹åŒ–ï¼Œå¹¶ä¸”é€šè¿‡éè¿›å…¥æ€§ä¿®æ”¹ `webpack` é…ç½®æ¥æ»¡è¶³ä»¥ä¸‹é…ç½®æ–¹æ¡ˆï¼š
1. é…ç½® `Typescript`ï¼›
2. é…ç½® `ESLint`ï¼›
3. é…ç½® `antd-mobile`ï¼Œå®ç°æŒ‰éœ€åŠ è½½å’Œè‡ªå®šä¹‰ä¸»é¢˜ï¼›
4. é…ç½® `commitizen`ï¼›
5. é…ç½® `.editorconfig`ã€‚
:::

<!-- more -->

> å‚è€ƒæ–‡æ¡£
> 1. [Create React App](https://create-react-app.dev/)
> 2. [React](https://react.docschina.org/)
> 3. [eslint-config-react-app](https://github.com/facebook/create-react-app/tree/master/packages/eslint-config-react-app)

## åˆå§‹åŒ–

### å¸¸è§„é¡¹ç›®

**npx** <Badge text="npm 5.2+" />

```bash
npx create-react-app my-app
cd my-app
npm start
```

**npm** <Badge text="npm 6+" />

```bash
npm init react-app my-app
```

**Yarn** <Badge text="npm 0.25+" />

```bash
yarn create react-app my-app
```

### `Typescript` é¡¹ç›®

```bash
npx create-react-app my-app --typescript
```

## é…ç½® Typescript

ä½¿ç”¨ä¸Šé¢çš„æ–¹å¼åˆå§‹åŒ– `Typescript` é¡¹ç›®ä¹‹åï¼Œä¼šå‡ºç°ä¸€äº›æ„å¤–çš„æŠ¥é”™éœ€è¦é¢å¤–çš„å»å¤„ç†ä¸€ä¸‹ã€‚

æˆ‘ä»¬å¯èƒ½ä¼šåœ¨ç¼–è¾‘å…¶ä¸­å‘ç° `tsconfig.json` æ–‡ä»¶çš„æœ€ä¸Šé¢æ˜¾ç¤ºä¸€ä¸ªæŠ¥é”™ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®‰è£… `@types/unist` æ¥è§£å†³ï¼š

```bash
npm install @types/unist --save-dev
```

æ”¾å®‰è£…å®Œ `@types/unist` åï¼Œåˆä¼šä¾æ¬¡æŠ¥ä¸¤ä¸ªé”™è¯¯ï¼Œæ ¹æ®æç¤ºå¾ˆæ˜æ˜¾å¯ä»¥çœ‹å‡ºæ˜¯ç¼ºå°‘å¦å¤–ä¸¤ä¸ª `types` æ–‡ä»¶ï¼š`@types/vfile` å’Œ `@types/vfile-message`ï¼š

```bash
npm install @types/vfile @types/vfile-message --save-dev
```

## é…ç½® ESLint

### ä»‹ç»

é…ç½®å¥½ `Typescript` ä¹‹åï¼Œæˆ‘ä»¬å½“ç„¶è¿˜å¸Œæœ›æ·»åŠ  `ESLint` ï¼ˆTypscript å®˜æ–¹å·²ç»æ”¾å¼ƒ TSLintï¼‰æ¥è§„èŒƒæˆ‘ä»¬çš„ä»£ç ä¹¦å†™æ ¼å¼ã€‚

### eslint-config-react-app

é¦–å…ˆæˆ‘ä»¬æ ¹ç»å®˜æ–¹æ¨èçš„æ–¹æ¡ˆ [eslint-config-react-app](https://github.com/facebook/create-react-app/tree/master/packages/eslint-config-react-app) æ¥é…ç½® `ESLint`ã€‚

#### å®‰è£…æ­¤ä¾èµ–ã€ESLintä»¥åŠç›¸å…³æ’ä»¶

```bash
npm install --save-dev eslint-config-react-app @typescript-eslint/eslint-plugin@2.x @typescript-eslint/parser@2.x babel-eslint@10.x eslint@6.x eslint-plugin-flowtype@3.x eslint-plugin-import@2.x eslint-plugin-jsx-a11y@6.x eslint-plugin-react@7.x eslint-plugin-react-hooks@1.x
```

#### æ ¹ç›®å½•åˆ›å»º `.eslintrc.js`

```json
{
  "extends": "react-app"
}
```

å¦‚æœè¦å¯ç”¨æ›´å¤šè§„åˆ™ï¼Œåˆ™å¯ä»¥è¿™æ ·é…ç½® `.eslintrc.js` ï¼š

```json
{
  "extends": ["react-app", "plugin:jsx-a11y/recommended"],
  "plugins": ["jsx-a11y"]
}
```

> [eslint-plugin-jsx-a11y](https://github.com/evcohen/eslint-plugin-jsx-a11y)  
> [airbnb](https://github.com/airbnb/javascript)

### è‡ªå®šä¹‰ `ESLint` è§„èŒƒ

é™¤äº†è¿™äº›æ’ä»¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ä¸€äº›è§„èŒƒï¼š

```js
module.exports = {
  "extends": ["eslint:recommended", "react-app", "plugin:jsx-a11y/recommended"],
  "plugins": ["jsx-a11y"],
  "rules": {
    "jsx-a11y/click-events-have-key-events": 0,
    "jsx-a11y/no-static-element-interactions": 0,
    "accessor-pairs": 2,
    "array-bracket-spacing": [2, "never"],
    "arrow-body-style": [2, "as-needed"],
    "arrow-parens": [2, "as-needed"],
    "arrow-spacing": 2,
    "block-scoped-var": 2,
    "block-spacing": 2,
    "brace-style": [2, "stroustrup", { "allowSingleLine": true }],
    "camelcase": 2,
    "comma-dangle": [2, "never"],
    "comma-spacing": [2, { "before": false, "after": true }],
    "comma-style": [2, "last"],
    "computed-property-spacing": [2, "never"],
    "consistent-this": [2, "_this"],
    "complexity": 2,
    "curly": 2,
    "consistent-return": 2,
    "default-case": 2,
    "dot-notation": 2,
    "eqeqeq": 2,
    "eol-last": 2,
    "func-call-spacing": [2, "never"],
    "guard-for-in": 2,
    "implicit-arrow-linebreak": [2, "beside"],
    "indent": [2, 2],
    "jsx-quotes": [2, "prefer-double"],
    "key-spacing": 2,
    "keyword-spacing": 2,
    "lines-around-comment": [2, { "beforeBlockComment": true }],
    "lines-between-class-members": [2, "always"],
    "multiline-comment-style": [2, "starred-block"],
    "new-cap": 0,
    "new-parens": 2,
    "no-alert": 1,
    "no-await-in-loop": 2,
    "no-caller": 2,
    "no-constructor-return": 2,
    "no-duplicate-imports": 2,
    "no-dupe-else-if": 2,
    "no-else-return": 2,
    "no-empty-function": 2,
    "no-eval": 2,
    "no-extend-native": 2,
    "no-extra-bind": 2,
    "no-extra-label": 2,
    "no-extra-parens": 2,
    "no-floating-decimal": 1,
    "no-import-assign": 2,
    "no-implicit-coercion": 2,
    "no-implied-eval": 2,
    "no-labels": 2,
    "no-label-var": 2,
    "no-lone-blocks": 2,
    "no-lonely-if": 2,
    "no-mixed-operators": 0,
    "no-multi-spaces": [2, {
      "exceptions": {
        "Property": false,
        "VariableDeclarator": true,
        "ImportDeclaration": true
      }
    }],
    "no-multi-str": 2,
    "no-multiple-empty-lines": [2, { "max": 1, "maxEOF": 1, "maxBOF": 0 }],
    "no-new": 2,
    "no-new-func": 2,
    "no-new-wrappers": 2,
    "no-octal-escape": 2,
    "no-param-reassign": 2,
    "no-setter-return": 2,
    "no-return-assign": 2,
    "no-return-await": 2,
    "no-script-url": 2,
    "no-self-compare": 2,
    "no-sequences": 2,
    "no-throw-literal": 2,
    "no-template-curly-in-string": 2,
    "no-trailing-spaces": 2,
    "no-undef-init": 2,
    "no-undefined": 2,
    "no-unmodified-loop-condition": 2,
    "no-use-before-define": 2,
    "no-useless-computed-key": 2,
    "no-useless-concat": 2,
    "no-useless-constructor": 2,
    "no-useless-rename": 2,
    "no-useless-return": 2,
    "no-var": 2,
    "no-warning-comments": [2, {
      "location": "anywhere"
    }],
    "no-whitespace-before-property": 2,
    "nonblock-statement-body-position": [2, "beside"],
    "object-curly-spacing": [2, "always"],
    "object-shorthand": 2,
    "operator-linebreak": [2, "before"],
    "prefer-const": 2,
    "prefer-destructuring": [2, {
      "array": true,
      "object": true
    }, {
      "enforceForRenamedProperties": false
    }],
    "prefer-promise-reject-errors": 2,
    "prefer-rest-params": 2,
    "prefer-spread": 2,
    "prefer-template": 2,
    "quotes": [2, "single"],
    "rest-spread-spacing": [2, "never"],
    "semi": [2, "never"],
    "space-before-blocks": 2,
    "space-before-function-paren": 2,
    "space-in-parens": [2, "never"],
    "space-infix-ops": 2,
    "spaced-comment": [2, "always"],
    "switch-colon-spacing": 2,
    "symbol-description": 2,
    "vars-on-top": 2
  }
}
```

### å¼€å¯ `ESLint`

è§„åˆ™æˆ‘ä»¬éƒ½å·²ç»é…ç½®å¥½äº†ï¼Œä½†æ˜¯å¯åŠ¨é¡¹ç›®åå‘ç°å¹¶ä¸ç”Ÿæ•ˆï¼Œè®°å¾—åœ¨æ—©æœŸçš„ `create-react-app` åˆå§‹åŒ–é¡¹ç›®æ—¶æ˜¯æœ‰ `ESLint` é€‰é¡¹çš„ï¼Œä½ å¯ä»¥é€‰æ‹©æ˜¯å¦å¼€å¯ `ESLint`ï¼Œä½†æ˜¯ç°åœ¨å‘ç°åˆå§‹åŒ–æ—¶æ²¡æœ‰é‚£äº›é€‰é¡¹ï¼Œå¹¶ä¸” `ESLint` ä¹Ÿæ˜¯å…³é—­çš„ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥å¼€å¯ã€‚

ä¸ºäº†ä¸é€šè¿‡ `eject` è¿™ç§ä¾µå…¥æ€§çš„æ–¹å¼æ¥ä¿®æ”¹ `webpack` é…ç½®ï¼Œæˆ‘ä»¬ä¸‹é¢å°†é€šè¿‡ `react-app-rewired` å’Œ `customize-cra` æ¥å¯¹ `webpack` è¿›è¡Œé…ç½®çš„å¢åŠ å’Œä¿®æ”¹ã€‚

#### å®‰è£…ä¾èµ–

```bash
npm install --save-dev react-app-rewired customize-cra
```

#### ä¿®æ”¹ `package.json`

å°† `react-scripts` ä¿®æ”¹ä¸º `react-app-rewired`ï¼š

```json
{
  "scripts": {
    "start": "react-app-rewired start",
    "build": "react-app-rewired build",
    "test": "react-app-rewired test --env=jsdom",
  }
}
```

#### æ ¹ç›®å½•åˆ›å»º `config-overrides.js`

```js
const { override, enableEslintTypescript, useEslintRc } = require('customize-cra')

module.exports = override(
  enableEslintTypescript(),
  useEslintRc('./.eslintrc.js')
)
```

**è¿˜æœ‰ä¸€ç§æ¯”è¾ƒç¬¨çš„æ–¹æ³•ï¼ŒåªåšæŠ€æœ¯äº¤æµï¼Œä¸æ¨èï¼š**

æˆ‘ä»¬é€šè¿‡æ‰“å° `config` å‘ç°ï¼Œ`ForkTsCheckerWebpackPlugin` æ’ä»¶é‡Œçš„ `eslint` ä¸º `false`ï¼Œè®¾ç½®ä¸º `true` å³å¯ã€‚

```js
module.exports = {
  webpack: function(config, env) {
    console.log(config)
    config.plugins.map((item, index) => {
      if(item.eslint && item.eslint === false){
        item.eslint = true
      }
      return item
    })
    return config
  }
}
```

## é…ç½® antd-mobile

### å®‰è£…å¹¶æŒ‰éœ€åŠ è½½

```bash
npm install antd-mobile --save
```

```js
// config-overrides.js
const {
  override,
  fixBabelImports
} = require('customize-cra')

module.exports = override(
  fixBabelImports('import', {
    libraryName: 'antd-mobile',
    style: 'css'
  })
)
```

### ä¸»é¢˜è‡ªå®šä¹‰

```bash
npm install less less-loader --save-dev
```

```js
// config-overrides.js
const {
  override,
  fixBabelImports,
  addLessLoader
} = require('customize-cra')

module.exports = override(
  fixBabelImports('import', {
    libraryName: 'antd-mobile',
    style: true // å°† 'css' æ”¹ä¸º trueï¼Œå¯åŠ¨ less
  }),
  addLessLoader({
    javascriptEnabled: true,
    modifyVars: { '@brand-primary': '#FA8C38' }
  })
)
```

## é…ç½® commitizen

### å®‰è£… commitizen

```bash
npm install commitizen --save-dev
```

### å®‰è£…adapter

`commitizen` æ ¹æ®ä¸åŒçš„adapteré…ç½® `commit message`ã€‚

#### è¦ä½¿ç”¨ Angular çš„ commit message æ ¼å¼ï¼Œå¯ä»¥å®‰è£… cz-conventional-changelog

```bash
npm install cz-conventional-changelog --save-dev
```

```json
{
  "scripts": {
    "commit": "git-cz"
  },
  "config": {
    "commitizen": {
      "path": "node_modules/cz-conventional-changelog"
    }
  }
}
```

#### cz-customizable å’Œ cz-conventional-changelog ä¸€æ ·ï¼Œä¹Ÿæ˜¯ commitizen çš„ adapterï¼Œä¸è¿‡æ”¯æŒä¸€å®šç¨‹åº¦ä¸Šçš„è‡ªå®šä¹‰

```bash
npm install cz-customizable --save-dev
```

```json
{
  "scripts": {
    "commit": "git-cz"
  },
  "config": {
    "commitizen": {
      "path": "node_modules/cz-customizable"
    }
  }
}
```

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.cz-config.js` æ–‡ä»¶,æ ¹æ® `node_modules/cz-customizable/cz-config-EXAMPLE.js` é…ç½® git cz æ—¶å¼¹å‡ºçš„ message å’Œå¯¹åº”çš„è¾“å…¥æˆ–è€…é€‰é¡¹ã€‚

```js
'use strict';

module.exports = {

  types: [
    {
      value: 'WIP',
      name : 'ğŸ’ª  WIP:      æœªå®Œå¾…ç»­'
    },
    {
      value: 'feat',
      name : 'âœ¨  feat:     æ–°çš„åŠŸèƒ½'
    },
    {
      value: 'fix',
      name : 'ğŸ  fix:      Bug ä¿®å¤'
    },
    {
      value: 'refactor',
      name : 'ğŸ›   refactor: åŠŸèƒ½é‡æ„'
    },
    {
      value: 'docs',
      name : 'ğŸ“š  docs:     æ–‡æ¡£ç›¸å…³'
    },
    {
      value: 'test',
      name : 'ğŸ  test:     æµ‹è¯•ç›¸å…³'
    },
    {
      value: 'chore',
      name : 'ğŸ—¯  chore:    çç¢äº‹é¡¹'
    },
    {
      value: 'style',
      name : 'ğŸ’…  style:    ä¼˜åŒ–ä»£ç ç»“æ„æˆ–æ ¼å¼'
    },
    {
      value: 'revert',
      name : 'âª  revert:   å›é€€ commit'
    }
  ],

  scopes: [],

  allowCustomScopes: true,
  allowBreakingChanges: ["feat", "fix"]
};
```

## é…ç½® .editorconfig

è§„èŒƒç¼–è¾‘å™¨çš„ç¼–è¾‘æ ¼å¼ï¼Œéœ€è¦é…åˆç¼–è¾‘å™¨çš„æ’ä»¶ä½¿ç”¨ï¼Œå¸¸ç”¨ç¼–è¾‘å™¨å‡ ä¹éƒ½æ”¯æŒã€‚

```
# http://editorconfig.org
root = true

[*]
charset = utf-8
indent_style = space
indent_size = 2
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true

[*.md]
insert_final_newline = false
trim_trailing_whitespace = false

```

## FAQ

### 1. TS2307: cannot find module '.png'

`TypeScript` ä¸­æ˜¯æ— æ³•è¯†åˆ«éä»£ç èµ„æºçš„ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™ `TS2307: cannot find module '.png'`ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸»åŠ¨çš„å»å£°æ˜è¿™ä¸ª `module` ã€‚æ–°å»ºä¸€ä¸ª ts å£°æ˜æ–‡ä»¶å¦‚ï¼š`images.d.ts`ï¼ˆå¦‚ä¸‹ï¼‰å°±å¯ä»¥äº†ã€‚è¿™æ · ts å°±å¯ä»¥è¯†åˆ« svgã€pngã€jpg ç­‰ç­‰å›¾ç‰‡ç±»å‹æ–‡ä»¶ã€‚é¡¹ç›®ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨å»è¯»å– `.d.ts` è¿™ç§ç±»å‹çš„æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åœ°åŠ è½½ä»–ä»¬ã€‚å½“ç„¶ `.d.ts` æ–‡ä»¶ä¹Ÿä¸èƒ½éšä¾¿æ”¾ç½®åœ¨é¡¹ç›®ä¸­ï¼Œè¿™ç±»æ–‡ä»¶å’Œtsæ–‡ä»¶ä¸€æ ·éœ€è¦è¢«typescriptç¼–è¯‘ï¼Œæ‰€ä»¥ä¸€æ ·åªèƒ½æ”¾ç½®åœ¨ `tsconfig.json` ä¸­ `include` å±æ€§æ‰€é…ç½®çš„æ–‡ä»¶å¤¹ä¸‹ã€‚

```ts
declare module '*.svg'
declare module '*.png'
declare module '*.jpg'
declare module '*.jpeg'
declare module '*.gif'
declare module '*.bmp'
declare module '*.tiff'
```

> å¦‚æœæŸä¸ªä¾èµ–åŒ…æ‰¾ä¸åˆ°ï¼Œè§£å†³åŠæ³•åŒä¸Šã€‚

### 2. flex å…ƒç´ è¶…å‡ºçˆ¶å…ƒç´ çš„è§£å†³æ–¹æ³•

`flex: auto` æœ¬æ¥æ˜¯è‡ªåŠ¨å¡«å……å‰©ä½™ç©ºé—´ï¼Œå¦‚æœè®¾ç½® `white-space: nowrap`ï¼Œåˆ™å¯èƒ½è¶…å‡ºçˆ¶çº§ï¼Œè§£å†³æ–¹æ³•æ˜¯è®¾ç½®ä¸º `width: 0` å°±å¯ä»¥äº†ã€‚

### 3. typescript && withRouter é”™è¯¯æç¤º

**é”™è¯¯å†…å®¹ **

`when use withRouter in your component under the typescript language,it may cause error below`ã€‚

**è§£å†³1ï¼š**

```ts
interface props {
  // your props here
}
interface states {
  // attributes needed in your component here
}
export class YourComponent extends React.Component<props, states>{
  // constructor in required here
  contructor (props: any){
    super(props);
    ...
  }
}
export default withRouter(YourComponent)
```

**è§£å†³2ï¼š**

```ts
type PathParamsType {
  // type whatever you expect in the this.props.match.params.*
}
type PropsType = RouteComponentProps<PathParamsType> & {
  // your props here
}
export class YourComponent extends React.Component<PropsType>{
  ...
}
export default withRouter(YourComponent)
```

### 4. create-react-appç»¼åˆé—®é¢˜ï¼ˆè½¬ï¼‰

[ç›´è¾¾](https://juejin.im/post/5ca5bd0ee51d4564221c4cf3)

### 5. customize-cra å’Œ react-app-rewired æ··ç”¨

```js
const {
  override,
  fixBabelImports,
  addLessLoader,
  addDecoratorsLegacy,
  addWebpackAlias
} = require('customize-cra');
const path = require('path');
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin;
 
const addCustomize = () => config => {
  if (process.env.NODE_ENV === 'production') {
    config.devtool = false; //å»æ‰mapæ–‡ä»¶
    if (config.plugins) {
      config.plugins.push(new BundleAnalyzerPlugin());
    }
    const splitChunksConfig = config.optimization.splitChunks;
     if (config.entry && config.entry instanceof Array) {
       config.entry = {
         main: config.entry,
         vendor: ["react", "react-dom", "react-router-dom", "react-redux", "redux", 'react-router-config',
           "lodash", "moment", 'react-intl', 'react-addons-pure-render-mixin', 'redux-promise-middleware', "react-router", 
         ]
       }
     } else if (config.entry && typeof config.entry === 'object') {
       config.entry.vendor = ["react", "react-dom", "react-router-dom", "react-redux", "redux", 'react-router-config', 
          "lodash", "moment", 'react-intl', 'react-addons-pure-render-mixin', 'redux-promise-middleware', "react-router", 
       ];
     }
 
    Object.assign(splitChunksConfig, {
      chunks: 'all',
      cacheGroups: {
        vendors: {
          test: /node_modules/,
          name: 'vendors',
          priority: -10,
        },
        common: {
          name: 'common',
          minChunks: 2,
          minSize: 30000,
          chunks: 'all'
        }
      }
    })
  }
  return config;
}
 
 
module.exports = override(
  fixBabelImports('lodash', {
    libraryDirectory: '',
    camel2DashComponentName: false
  }),
  addLessLoader({
    modifyvars: {
      "@icon-url": `${path.resolve(__dirname,'build/assets/font/iconfont')}`, //ä½¿ç”¨æœ¬åœ°å­—ä½“æ–‡ä»¶
      '@font-size-base': '13px',
      '@primary-color': '#00879C'
    },
    javascriptEnabled: true
  }),
  addWebpackAlias({
    '@': path.resolve(__dirname, 'src')
  }),
  addDecoratorsLegacy(),
  addCustomize()
)
```

[ç›´è¾¾](https://blog.csdn.net/u014744118/article/details/88783119)

### 6. rem

[ç›´è¾¾](https://blog.csdn.net/lvyang251314/article/details/82798858)

### 7. æµè§ˆå™¨æŸ¥çœ‹ redux

[ç›´è¾¾](https://github.com/zalmoxisus/redux-devtools-extension)
