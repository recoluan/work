<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <script>
    class Camera {
      shot (car) {
        return {
          num: car.num,
          inTime: Date.now()
        }
      }
    }

    class Screen {
      show (num, inTime) {
        const stayTime = Date.now() - inTime
        console.log(`${num} 停留 ${stayTime}`)
      }
    }

    class Car {
      constructor(num) {
        this.num = num
      }
    }

    class Park {
      constructor(floors) {
        this.floors = floors || []
        this.carList = {}
        this.camera = new Camera()
        this.screen = new Screen()
      }
      in (car) {
        const info = this.camera.shot(car)
        const i = parseInt(Math.random() * 100)
        const place = this.floors[0].places[i]
        place.in()
        info.place = place
        this.carList[car.num] = info
      }
      out (car) {
        const { num, inTime, place } = this.carList[car.num]
        this.screen.show(num, inTime)
        place.out()
        delete this.carList[num]
      }
      emptyNum () {
        return this.floors.map(floor => {
          return `第 ${floor.index} 层还有 ${floor.emptyFloorNum()} 个停车位`
        }).join('\n')
      }
    }
    class Floor {
      constructor (index, places) {
        this.index = index
        this.places = places || []
      }

      emptyFloorNum () {
        let num = 0
        this.places.forEach(place => {
          if (place.empty) num++
        })
        return num
      }
    }
    class Place {
      constructor () {
        this.empty = true
      }
      in () {
        this.empty = false
      }
      out () {
        this.empty = true
      }
    }

    let floors = []
    for (let i = 0; i < 3; i++) {
      const floor = []
      for (let j = 0; j < 100; j++) {
        floor.push(new Place())
      }
      floors.push(new Floor(i, floor))
    }
    const park = new Park(floors)
    const car1 = new Car(100)
    const car2 = new Car(200)
    const car3 = new Car(300)

    console.log(park.emptyNum())
    park.in(car1)
    console.log(park.emptyNum())

    park.in(car2)
    console.log(park.emptyNum())
    park.out(car1)
    console.log(park.emptyNum())

  </script>
</head>

<body>
  <div class="wrapper"></div>
</body>

</html>