<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  
</head>

<body>
  <img src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3771958983,3736755623&fm=26&gp=0.jpg" alt="">
  <img src="https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=1828898419,2771727531&fm=26&gp=0.jpg" alt="">
  <script>
    //一个对象，存储页面图片数量和下载的数量
var monitorObj = {
    imgTotal: 0,
    imgLoaded: 0
}
//创建a标签，赋予图片对象相关属性，并插入body
var createA = function (obj) {
    var a = document.createElement("a");
    a.id = obj.id;
    a.target = "_blank";//注意：要在新页面打开
    let imgDom = document.createElement('img')
    imgDom.src = obj.url
    let canvas = convertImageToCanvas(imgDom)
    url = canvas.toDataURL('image/png')
    a.href = url;
    a.download = `${obj.id}.png`;

    document.body.appendChild(a);
}

const convertImageToCanvas = function (image) {
        let canvas = document.createElement('canvas')
        canvas.width = image.width
        canvas.height = image.height
        let context = canvas.getContext('2d')
        context.drawImage(image, 0, 0)
        return canvas
      }

//获取页面的图片
var imgs = document.images;
console.log(imgs)
//创建每个图片对象的对应a标签
for (var i = 0; i < imgs.length;i++){
    var obj = {
        id: "img_" + i,
        url: imgs[i].src
    }
    //统计图片数量
    monitorObj.imgTotal++;

    console.log(obj)
    createA(obj);
}
//开始下载图片
for (var i = 0; i < imgs.length; i++) {
    if (document.getElementById("img_" + i)) {
        //重点：触发a标签的click事件        
        document.getElementById("img_" + i).click();
        monitorObj.imgLoaded++; //统计已下载的图片数量
    } 
} 
console.log("已下载："+monitorObj.imgLoaded + "/" + monitorObj.imgTotal);
  </script>
</body>

</html>